<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SyncTrip.App.Features.Garage.ViewModels"
             xmlns:dto="clr-namespace:SyncTrip.Shared.DTOs.Vehicles;assembly=SyncTrip.Shared"
             x:Class="SyncTrip.App.Features.Garage.Views.GarageView"
             x:DataType="vm:GarageViewModel">

    <Grid>
        <StackPanel Margin="20" Spacing="15">

            <TextBlock Text="Mes vehicules" FontSize="24" FontWeight="Bold" Margin="0,20,0,10" />

            <!-- Loading -->
            <ProgressBar IsVisible="{Binding IsLoading}" IsIndeterminate="True" Height="4" />

            <!-- Empty State -->
            <StackPanel IsVisible="{Binding IsEmpty}" Spacing="20" Margin="0,60,0,0" HorizontalAlignment="Center">
                <TextBlock Text="Aucun vehicule" FontSize="20" FontWeight="Bold" HorizontalAlignment="Center" />
                <TextBlock Text="Ajoutez votre premier vehicule pour commencer"
                           FontSize="14" Foreground="{DynamicResource Gray500Brush}"
                           HorizontalAlignment="Center" TextAlignment="Center" />
            </StackPanel>

            <!-- Vehicle List -->
            <ItemsControl ItemsSource="{Binding Vehicles}"
                          IsVisible="{Binding IsEmpty, Converter={StaticResource InvertedBoolConverter}}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="dto:VehicleDto">
                        <Border BorderBrush="{DynamicResource Gray300Brush}" BorderThickness="1"
                                CornerRadius="15" Padding="15" Margin="0,5">
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto" RowSpacing="6">
                                <TextBlock Grid.Row="0" Grid.Column="0"
                                           Text="{Binding BrandName}" FontSize="12" FontWeight="Bold"
                                           Foreground="{DynamicResource Gray500Brush}" />
                                <TextBlock Grid.Row="1" Grid.Column="0"
                                           Text="{Binding Model}" FontSize="20" FontWeight="Bold" />

                                <Button Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
                                        Content="Supprimer"
                                        Command="{Binding $parent[ItemsControl].((vm:GarageViewModel)DataContext).DeleteVehicleCommand}"
                                        CommandParameter="{Binding Id}"
                                        Background="{DynamicResource ErrorBrush}" Foreground="White"
                                        CornerRadius="8" VerticalAlignment="Center" />

                                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                            Orientation="Horizontal" Spacing="15">
                                    <Border Background="{DynamicResource PrimaryBrush}" Padding="8,4" CornerRadius="8">
                                        <TextBlock Text="{Binding Type, Converter={StaticResource VehicleTypeConverter}}"
                                                   FontSize="12" Foreground="White" FontWeight="Bold" />
                                    </Border>
                                    <TextBlock Text="{Binding Color}"
                                               IsVisible="{Binding Color, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                                               FontSize="14" VerticalAlignment="Center" />
                                    <TextBlock Text="{Binding Year}"
                                               IsVisible="{Binding Year, Converter={StaticResource IsNotNullConverter}}"
                                               FontSize="14" VerticalAlignment="Center" />
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Error -->
            <Border IsVisible="{Binding ErrorMessage, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                    BorderBrush="{DynamicResource ErrorBrush}" BorderThickness="1" CornerRadius="10" Padding="15">
                <TextBlock Text="{Binding ErrorMessage}" Foreground="{DynamicResource ErrorBrush}" HorizontalAlignment="Center" TextWrapping="Wrap" />
            </Border>

            <!-- Success -->
            <Border IsVisible="{Binding SuccessMessage, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                    BorderBrush="{DynamicResource SuccessBrush}" BorderThickness="1" CornerRadius="10" Padding="15">
                <TextBlock Text="{Binding SuccessMessage}" Foreground="{DynamicResource SuccessBrush}" HorizontalAlignment="Center" TextWrapping="Wrap" />
            </Border>

            <!-- Add + Refresh buttons -->
            <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right" Margin="0,10,0,0">
                <Button Content="Rafraichir" Command="{Binding RefreshCommand}" CornerRadius="10" />
                <Button Content="+ Ajouter"
                        Command="{Binding AddVehicleCommand}"
                        Background="{DynamicResource PrimaryBrush}" Foreground="White"
                        CornerRadius="10" FontWeight="Bold" />
            </StackPanel>
        </StackPanel>
    </Grid>

</UserControl>
